# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

1. **–ü–µ—Ä–µ–¥–µ–ª–∞–Ω `back/controllers/cartController.js`** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL –≤–º–µ—Å—Ç–æ Supabase
2. –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä—è–º—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ `pg` pool
3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ—Å—Å–∏–π** –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–Ω–æ—Å –∫–æ—Ä–∑–∏–Ω—ã** –∏–∑ —Å–µ—Å—Å–∏–∏ –≤ –ë–î –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
5. –ë—ç–∫–µ–Ω–¥ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ PostgreSQL

## üîß –§—É–Ω–∫—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã

### API Endpoints:
- `GET /api/cart` - –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)
- `POST /api/cart/add` - –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö)
- `POST /api/cart/remove` - –£–¥–∞–ª–∏—Ç—å –æ–¥–Ω—É –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö)
- `POST /api/cart/clear` - –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö)
- `POST /api/cart/merge` - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∫–æ—Ä–∑–∏–Ω—É –∏–∑ —Å–µ—Å—Å–∏–∏ –≤ –ë–î (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –ë–ï–ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**: `http://localhost/`
2. **–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É**:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥: `http://localhost/catalog`
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –∫–æ—Ä–∑–∏–Ω—ã —É –ª—é–±–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
   - –¢–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –¥–æ–±–∞–≤–∏—Ç—å—Å—è (–ø–æ—è–≤–∏—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–î–æ–±–∞–≤–ª–µ–Ω–æ!")
3. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ—Ä–∑–∏–Ω—É**: `http://localhost/basket`
   - –ö–æ—Ä–∑–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
   - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, —É–¥–∞–ª–µ–Ω–∏–µ)
4. **–ó–∞–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–Ω–æ–≤–∞**
   - –ö–æ—Ä–∑–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è (–±–ª–∞–≥–æ–¥–∞—Ä—è —Å–µ—Å—Å–∏—è–º)

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–µ—Ä–µ–Ω–æ—Å –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

1. **–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –ë–ï–ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** (–∫–∞–∫ –≤ –°—Ü–µ–Ω–∞—Ä–∏–∏ 1)
2. **–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É**: `http://localhost/login`
3. **–ö–æ—Ä–∑–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ—Ç—Å—è** –≤ –≤–∞—à—É —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä–∑–∏–Ω—É** - –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

1. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å**: `http://localhost/register`
2. **–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É**: `http://localhost/login`
3. **–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É**
   - –¢–æ–≤–∞—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. **–í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞**
   - –ö–æ—Ä–∑–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –∫–æ—Ä–∑–∏–Ω—ã
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–∫–Ω–æ–ø–∫–∞ +)
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–∫–Ω–æ–ø–∫–∞ -)
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–∫–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å")
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã (–∫–Ω–æ–ø–∫–∞ "–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É")
- ‚úÖ –ü–æ–¥—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞

## üêõ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

### –õ–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞:
```bash
docker logs ritto-backend --tail 50 -f
```

### –õ–æ–≥–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
```bash
docker logs ritto-frontend --tail 50 -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã
docker exec ritto-postgres psql -U ritto_user -d ritto_db -c "SELECT * FROM cart;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã
docker exec ritto-postgres psql -U ritto_user -d ritto_db -c "SELECT id, name, price FROM products LIMIT 5;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
docker exec ritto-postgres psql -U ritto_user -d ritto_db -c "SELECT id, email FROM users;"
```

## üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
# –¢–æ–ª—å–∫–æ –±—ç–∫–µ–Ω–¥
docker restart ritto-backend

# –¢–æ–ª—å–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
docker restart ritto-frontend

# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose restart
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω—ã

### –¢–∞–±–ª–∏—Ü–∞ `cart`:
- `id` - UUID –∫–æ—Ä–∑–∏–Ω—ã
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `product_id` - ID –ø—Ä–æ–¥—É–∫—Ç–∞
- `quantity` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞
- `created_at` - –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
- `updated_at` - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –û—Ç–≤–µ—Ç API `GET /api/cart`:
```json
{
  "items": [
    {
      "id": "cart-item-uuid",
      "quantity": 2,
      "productId": "product-uuid",
      "name": "Wok —Å –ö—Ä–µ–≤–µ—Ç–∫–æ–π",
      "price": 439.00,
      "image": "/uploads/image.jpg",
      "category": "Wok",
      "description": "–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
    }
  ]
}
```

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
1. **–ö–æ—Ä–∑–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `express-session` —Å PostgreSQL store
2. **–°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è 30 –¥–Ω–µ–π** - –∫–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø—Ä–æ–ø–∞–¥–µ—Ç –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
3. **–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞

### –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
1. **–ö–æ—Ä–∑–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î** - —Ç–∞–±–ª–∏—Ü–∞ `cart` —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ `user_id`
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–Ω–æ—Å** - –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ –∫–æ—Ä–∑–∏–Ω–∞ –∏–∑ —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –≤ –ë–î
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –µ—Å—Ç—å –≤ –ë–î, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è

### –û–±—â–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞** - –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
2. **–£–º–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** - –ø—Ä–∏ quantity > 1 —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 1, –ø—Ä–∏ quantity = 1 —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
3. **JOIN —Å products** - –∫–æ—Ä–∑–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–∞—Ö
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
5. **Middleware `optionalAuth`** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω, –Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –µ–≥–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π

- –°–µ—Å—Å–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL (—Ç–∞–±–ª–∏—Ü–∞ `session`)
- Cookie —Å `httpOnly` —Ñ–ª–∞–≥–æ–º (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Å–µ—Å—Å–∏–π
- –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Å–µ—Å—Å–∏–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `.env`)

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å PostgreSQL, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö, —Ç–∞–∫ –∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é.
